<?xml version = "1.0" encoding = "UTF-8" ?>
<!--
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  Oracle JDeveloper BPEL Designer 
  
  Created: Sat Dec 04 21:51:46 ECT 2021
  Author:  alexjcm
  Type: BPEL 2.0 Process
  Purpose: Synchronous BPEL Process
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
-->
<process name="SuperBPELProcess"
               targetNamespace="http://xmlns.oracle.com/TestSOAApplication/CompositeProj/SuperBPELProcess"
               xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
               xmlns:client="http://xmlns.oracle.com/TestSOAApplication/CompositeProj/SuperBPELProcess"
               xmlns:ora="http://schemas.oracle.com/xpath/extension"
               xmlns:ui="http://xmlns.oracle.com/soa/designer"
               xmlns:bpelx="http://schemas.oracle.com/bpel/extension"
         xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
    
         xmlns:ns4="http://xmlns.oracle.com/TestSOAApplication/CompositeProj/RestService"
         xmlns:ns5="http://TargetNamespace.com/RestService_getCustomerOperation_request"
         xmlns:ns6="http://TargetNamespace.com/RestService_getCustomerOperation_response"
         xmlns:ns7="http://xmlns.oracle.com/TestSOAApplication/CompositeProj/CustomerRestRef"
         xmlns:ns8="http://TargetNamespace.com/CustomerRestRef_getCustomerEROperation_request"
         xmlns:ns9="http://TargetNamespace.com/CustomerRestRef_getCustomerEROperation_response"
         xmlns:ns10="http://xmlns.oracle.com/TestSOAApplication/CompositeProj/OrderrRestRef"
         xmlns:ns1="http://TargetNamespace.com/OrderrRestRef_createOrderrEROperation_request"
         xmlns:oraext="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.ExtFunc"
         xmlns:bpm="http://xmlns.oracle.com/bpmn20/extensions"
         xmlns:xp20="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.Xpath20"
         xmlns:ess="http://xmlns.oracle.com/scheduler" xmlns:hwf="http://xmlns.oracle.com/bpel/workflow/xpath"
         xmlns:xref="http://www.oracle.com/XSL/Transform/java/oracle.tip.xref.xpath.XRefXPathFunctions"
         xmlns:dvm="http://www.oracle.com/XSL/Transform/java/oracle.tip.dvm.LookupValue"
         xmlns:bpws="http://schemas.xmlsoap.org/ws/2003/03/business-process/"
         xmlns:xdk="http://schemas.oracle.com/bpel/extension/xpath/function/xdk"
         xmlns:ids="http://xmlns.oracle.com/bpel/services/IdentityService/xpath"
         xmlns:ldap="http://schemas.oracle.com/xpath/extension/ldap"
         xmlns:ns2="http://TargetNamespace.com/OrderrRestRef_createOrderrEROperation_response">

    <!-- 
      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        PARTNERLINKS                                                      
        List of services participating in this BPEL process               
      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    -->
  <import namespace="http://TargetNamespace.com/OrderrRestRef_createOrderrEROperation_response"
          location="../Schemas/orderr_response_er.xsd" importType="http://www.w3.org/2001/XMLSchema"/>
  <import namespace="http://xmlns.oracle.com/TestSOAApplication/CompositeProj/RestService"
          location="../WSDLs/RestService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/" ui:processWSDL="true"/>
  <partnerLinks>
    <!-- 
      The 'client' role represents the requester of this service. It is 
      used for callback. The location and correlation information associated
      with the client role are automatically set using WS-Addressing.
    -->
    <partnerLink name="RestService" partnerLinkType="ns4:RestService" myRole="RestServiceProvider"/>
    <partnerLink name="CustomerRestRef" partnerLinkType="ns7:CustomerRestRef" partnerRole="CustomerRestRefProvider"/>
    <partnerLink name="OrderrRestRef" partnerLinkType="ns10:OrderrRestRef" partnerRole="OrderrRestRefProvider"/>
  </partnerLinks>

  <!-- 
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
      VARIABLES                                                        
      List of messages and XML documents used within this BPEL process 
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  -->
  <variables>
    <!-- Reference to the message passed as input during initiation -->

    <!-- Reference to the message that will be returned to the requester-->
    <variable name="receiveInput_getCustomerOp_InputVariable" messageType="ns4:getCustomerOperation_inputMessage"/>
    <variable name="replyOutput_getCustomerOp_OutputVariable" messageType="ns4:getCustomerOperation_outputMessage"/>
    <variable name="invokeCustomer_getCustomerEROperation_InputVariable"
              messageType="ns7:getCustomerEROperation_inputMessage"/>
    <variable name="invokeCustomer_getCustomerEROperation_OutputVariable"
              messageType="ns7:getCustomerEROperation_outputMessage"/>
    <variable name="invokeCreateOrderr_createOrderrEROp_InputVariable"
              messageType="ns10:createOrderrEROperation_inputMessage"/>
    <variable name="invokeCreateOrderr_createOrderrEROp_OutputVariable"
              messageType="ns10:createOrderrEROperation_outputMessage"/>
    <variable name="infoOderrCreated" element="ns2:Root-Element"/>
  </variables>

  <!-- 
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
     ORCHESTRATION LOGIC                                               
     Set of activities coordinating the flow of messages across the    
     services integrated within this business process                  
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  -->
  <sequence name="main">

    <!-- Receive input from requestor. (Note: This maps to operation defined in SuperBPELProcess.wsdl) -->
    <receive name="receiveInput" partnerLink="RestService" portType="ns4:RestService_ptt"
             operation="getCustomerOperation" variable="receiveInput_getCustomerOp_InputVariable" createInstance="yes"/>
    <assign name="assignInCustomer">
      <copy>
        <from>$receiveInput_getCustomerOp_InputVariable.request/ns5:customer/ns5:taxIdentificationNumber</from>
        <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$invokeCustomer_getCustomerEROperation_InputVariable.request/ns8:customer/ns8:taxIdentificationNumber</to>
      </copy>
    </assign>
    <invoke name="invokeCustomer" partnerLink="CustomerRestRef" portType="ns7:CustomerRestRef_ptt"
            operation="getCustomerEROperation" inputVariable="invokeCustomer_getCustomerEROperation_InputVariable"
            outputVariable="invokeCustomer_getCustomerEROperation_OutputVariable" bpelx:invokeAsDetail="no"/>
    <assign name="assignOutCustomer">
      <copy ignoreMissingFromData="yes">
        <from>$invokeCustomer_getCustomerEROperation_OutputVariable.reply/ns9:customer/ns9:birthDate</from>
        <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$replyOutput_getCustomerOp_OutputVariable.reply/ns6:customer/ns6:birthDate</to>
      </copy>
      <copy>
        <from>$invokeCustomer_getCustomerEROperation_OutputVariable.reply/ns9:customer/ns9:customerCode</from>
        <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$replyOutput_getCustomerOp_OutputVariable.reply/ns6:customer/ns6:customerCode</to>
      </copy>
      <copy>
        <from>$invokeCustomer_getCustomerEROperation_OutputVariable.reply/ns9:customer/ns9:firstName</from>
        <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$replyOutput_getCustomerOp_OutputVariable.reply/ns6:customer/ns6:firstName</to>
      </copy>
      <copy>
        <from>$invokeCustomer_getCustomerEROperation_OutputVariable.reply/ns9:customer/ns9:id</from>
        <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$replyOutput_getCustomerOp_OutputVariable.reply/ns6:customer/ns6:id</to>
      </copy>
      <copy>
        <from>$invokeCustomer_getCustomerEROperation_OutputVariable.reply/ns9:customer/ns9:lastName</from>
        <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$replyOutput_getCustomerOp_OutputVariable.reply/ns6:customer/ns6:lastName</to>
      </copy>
      <copy>
        <from>$invokeCustomer_getCustomerEROperation_OutputVariable.reply/ns9:customer/ns9:taxIdentificationNumber</from>
        <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$replyOutput_getCustomerOp_OutputVariable.reply/ns6:customer/ns6:taxIdentificationNumber</to>
      </copy>
    </assign>
    <assign name="assignInputOrderr">
      <copy>
        <from expressionLanguage="javascript">((Math.random() * (10000 - 1)) + 1).toFixed()</from>
        <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$invokeCreateOrderr_createOrderrEROp_InputVariable.request/ns1:orderr/ns1:documentNumber</to>
      </copy>
      <copy>
        <from expressionLanguage="javascript">'2021-11-18T00:00:00-05:00'</from>
        <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$invokeCreateOrderr_createOrderrEROp_InputVariable.request/ns1:orderr/ns1:orderrDate</to>
      </copy>
      <copy>
        <from>$replyOutput_getCustomerOp_OutputVariable.reply/ns6:customer/ns6:id</from>
        <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$invokeCreateOrderr_createOrderrEROp_InputVariable.request/ns1:orderr/ns1:customerId</to>
      </copy>
    </assign>
    <invoke name="invokeCreateOrderr" partnerLink="OrderrRestRef"
            portType="ns10:OrderrRestRef_ptt" operation="createOrderrEROperation"
            inputVariable="invokeCreateOrderr_createOrderrEROp_InputVariable"
            outputVariable="invokeCreateOrderr_createOrderrEROp_OutputVariable" bpelx:invokeAsDetail="no"/>
    <assign name="assignOrderrCreated">
      <copy>
        <from>$invokeCreateOrderr_createOrderrEROp_OutputVariable.reply/ns2:orderr/ns2:documentNumber</from>
        <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$infoOderrCreated/ns2:orderr/ns2:documentNumber</to>
      </copy>
      <copy>
        <from>$invokeCreateOrderr_createOrderrEROp_OutputVariable.reply/ns2:orderr/ns2:id</from>
        <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$infoOderrCreated/ns2:orderr/ns2:id</to>
      </copy>
    </assign>
    <!-- Generate reply to synchronous request -->
    <reply name="replyOutput" partnerLink="RestService" portType="ns4:RestService_ptt" operation="getCustomerOperation"
           variable="replyOutput_getCustomerOp_OutputVariable"/>
  </sequence>
</process>